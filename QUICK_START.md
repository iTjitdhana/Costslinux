# ЁЯЪА р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Фр╣Ир╕зр╕Щ - Merge Database

## р╕Ыр╕▒р╕Нр╕лр╕▓
р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г merge р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Б `esp_tracker_empty` р╣Ар╕Вр╣Йр╕▓ `esp_tracker` р╣Вр╕Фр╕вр╣Др╕бр╣Ир╣Гр╕лр╣Йр╣Ар╕Бр╕┤р╕Ф ID conflict

## р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Йр╣Др╕Вр╕Фр╣Ир╕зр╕Щ

### 1. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
```bash
node generate_batch_ids.js --check
```

### 2. Backup р╕Вр╣Йр╕нр╕бр╕╣р╕е (р╕кр╕│р╕Др╕▒р╕Н!)
```bash
node backup_database.js
```

### 3. р╕Чр╕│р╕Бр╕▓р╕г merge
```bash
# р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 1: р╣Гр╕Кр╣Й batch script (Windows)
merge_databases.bat

# р╕зр╕┤р╕Шр╕╡р╕Чр╕╡р╣И 2: р╣Гр╕Кр╣Йр╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Вр╕Фр╕вр╕Хр╕гр╕З
node generate_batch_ids.js --merge
```

### 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
```bash
node verify_merge.js --detailed
```

## р╣Др╕Яр╕ер╣Мр╕кр╕│р╕Др╕▒р╕Н
- `generate_batch_ids.js` - Script р╕лр╕ер╕▒р╕Б
- `verify_merge.js` - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
- `backup_database.js` - Backup р╕Вр╣Йр╕нр╕бр╕╣р╕е
- `rollback_database.js` - Rollback р╕лр╕▓р╕Бр╣Ар╕Бр╕┤р╕Фр╕Ыр╕▒р╕Нр╕лр╕▓
- `merge_databases.bat` - Batch script р╕кр╕│р╕лр╕гр╕▒р╕Ъ Windows

## тЪая╕П р╕Вр╣Йр╕нр╕Др╕зр╕гр╕гр╕░р╕зр╕▒р╕З
1. **р╕Чр╕│ backup р╣Ар╕кр╕бр╕н** р╕Бр╣Ир╕нр╕Щ merge
2. р╕Чр╕Фр╕кр╕нр╕Ър╣Гр╕Щ environment р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щ
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕лр╕ер╕▒р╕З merge
4. р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б offset р╕Чр╕╡р╣Ир╣Гр╕Кр╣Йр╕кр╕│р╕лр╕гр╕▒р╕Ъ rollback

## ЁЯЖШ р╕лр╕▓р╕Бр╣Ар╕Бр╕┤р╕Фр╕Ыр╕▒р╕Нр╕лр╕▓
1. р╣Гр╕Кр╣Й `rollback_database.js --confirm` р╣Ар╕Юр╕╖р╣Ир╕н rollback
2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ log error
3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ database connection
