# üöÄ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - Merge Database (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï)

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤
‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ merge ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `esp_tracker_empty` ‡πÄ‡∏Ç‡πâ‡∏≤ `esp_tracker` ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î ID conflict

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
```bash
node generate_batch_ids.js --check
```

### 2. Backup ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!)
```bash
node backup_database.js
```

### 3. ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ merge
```bash
# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ batch script (Windows)
merge_databases.bat

# ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
node generate_batch_ids.js --merge
```

### 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
```bash
node verify_merge.js --detailed
```

## ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

### Scripts ‡∏´‡∏•‡∏±‡∏Å
- `generate_batch_ids.js` - Script ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö merge ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- `verify_merge.js` - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á merge
- `backup_database.js` - Backup ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô merge
- `rollback_database.js` - Rollback ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### Scripts ‡∏£‡∏≠‡∏á
- `merge_databases.bat` - Batch script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Windows
- `backup_info.json` - ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• backup (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î

### ‡∏Å‡∏≤‡∏£ Backup
```bash
# Backup ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
node backup_database.js

# ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ backup ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
node backup_database.js --list
```

### ‡∏Å‡∏≤‡∏£ Merge
```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô merge
node generate_batch_ids.js --check

# ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ merge
node generate_batch_ids.js --merge
```

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
node verify_merge.js

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
node verify_merge.js --detailed
```

### ‡∏Å‡∏≤‡∏£ Rollback
```bash
# Rollback ‡πÉ‡∏ä‡πâ backup ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
node rollback_database.js --confirm

# Rollback ‡πÉ‡∏ä‡πâ backup ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏
node rollback_database.js <backup_database_name> --confirm

# ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ backup
node rollback_database.js --list

# ‡∏î‡∏π‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
node rollback_database.js --help
```

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå

```bash
# 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
node generate_batch_ids.js --check

# 2. Backup ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
node backup_database.js

# 3. ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£ merge
node generate_batch_ids.js --merge

# 4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
node verify_merge.js --detailed

# 5. ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ - Rollback
node rollback_database.js --confirm
```

## ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô work_plans ‡πÅ‡∏•‡∏∞ logs ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ database
- work_plans ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô
- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

### ‡∏Å‡∏≤‡∏£ Backup
- ‡∏™‡∏£‡πâ‡∏≤‡∏á backup database ‡∏û‡∏£‡πâ‡∏≠‡∏° timestamp
- Backup tables: work_plans, logs, production_batches, finished_flags, work_plan_operators
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå backup_info.json

### ‡∏Å‡∏≤‡∏£ Merge
- ‡πÉ‡∏ä‡πâ offset ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô work_plan_id
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡∏Å‡πà‡∏≠‡∏ô insert
- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï AUTO_INCREMENT
- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£ merge

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á Merge
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- Foreign key integrity
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥
- ‡∏ä‡πà‡∏ß‡∏á ID ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- AUTO_INCREMENT values

## ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á

1. **‡∏ó‡∏≥ backup ‡πÄ‡∏™‡∏°‡∏≠** ‡∏Å‡πà‡∏≠‡∏ô merge
2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏ô environment ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏•‡∏±‡∏á merge
4. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å offset ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ rollback
5. ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠ backup database ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö rollback

## üÜò ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö log error
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö database connection
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö permissions

### ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ rollback
1. ‡πÉ‡∏ä‡πâ `node rollback_database.js --confirm`
2. ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏∏ backup database: `node rollback_database.js <backup_name> --confirm`

### ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏û‡∏ö backup
1. ‡πÉ‡∏ä‡πâ `node backup_database.js --list` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ backup
2. ‡πÉ‡∏ä‡πâ `node rollback_database.js --list` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ backup

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå `config.env` ‡∏´‡∏£‡∏∑‡∏≠ environment variables:
- `DB_HOST`: MySQL host (default: 192.168.0.94)
- `DB_USER`: MySQL username (default: jitdhana)
- `DB_PASSWORD`: MySQL password (default: iT12345$)

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á backup database ‡∏ä‡∏∑‡πà‡∏≠ `esp_tracker_backup_YYYY-MM-DDTHH-MM-SS`
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• backup ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå `backup_info.json`
- ‡∏Å‡∏≤‡∏£ rollback ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ work_plan_id ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô backup
- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
